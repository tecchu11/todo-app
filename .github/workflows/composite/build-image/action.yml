name: Build Image

inputs:
  github-token:
    description: Login token for ghcr
    required: true
  build-target-module:
    description: Build target module name
    required: true

runs:
  using: composite
  steps:
    - uses: actions/setup-java@v3
      with:
        distribution: 'adopt'
        java-version: '11'
        cache: 'gradle'

    - name: Login ghcr
      shell: bash
      run: |
        echo "${{ inputs.github-token }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin

    - name: Build Image
      shell: bash
      run: |
        ./gradlew ${{ github.event.inputs.project }}:jib --no-daemon -Djib.to.tags=${{ github.sha }}
